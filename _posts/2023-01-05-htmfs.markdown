---
layout: paper-summary
title:  "HTMFS: Strong Consistency Comes for Free with Hardware Transactional Memory in Persistent Memory File Systems"
date:   2022-01-05 19:40:00 -0500
categories: paper
paper_title: "HTMFS: Strong Consistency Comes for Free with Hardware Transactional Memory in Persistent Memory File Systems"
paper_link: https://www.usenix.org/system/files/fast22-yi.pdf
paper_keyword: NVM; File System; HTM
paper_year: FAST 2022
rw_set:
htm_cd:
htm_cr:
version_mgmt:
---

**Comments:**

1. The paper seems to mix two different types of consistency: multi-threaded synchronization, i.e., consistency
at the memory ordering level, and durability, i.e., consistency for crash recovery. While Intel RTM guarantees both,
these two types of consistency requirements have different considerations. For example, durability problems can
occur even with a single thread. The paper started with consistency for crash recovery but focused more on
multi-threaded synchronization throughout the body.

This paper presents HTMFS, a file system that leverages existing Hardware Transactional Memory (HTM) support to
provide strong consistency guarantees while incurring low overhead. HTMFS achieves its design goals by wrapping 
multi-store operations within hardware transactions, whose atomicity is guaranteed by the hardware. As a result,
HTMFS, compared with similar designs that use journaling or shadow paging, achieves similar or better performance 
without weakening the consistency guarantees.

The paper was motivated by the high overhead for maintaining consistency in conventional file systems. The paper 
has noted that conventional file systems use either journaling or shadow paging to maintain crash consistency. 
Both approaches, however, involve a large overhead.
In the case of journaling, the same data is written twice, hence incurring 2x write amplification. 
In the case of shadow paging, even a small write to a data page can result in numerous writes to copy the page 
and update page pointers, causing an avalanche effect, as the paper authors have observed with NOVA.
Consequently, conventional file systems often chose to trade-off consistency guarantees for better performance.