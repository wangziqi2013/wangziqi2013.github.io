---
layout: post
title:  "Understanding Ariel Core Simulation in SST"
date:   2021-11-08 02:04:00 -0500
categories: article
ontop: false
---

# Ariel Core

## Ariel Frontend

The ariel frontend defined in `class ArielFrontend` is a generic interface for the Ariel core to obtain a tunnel object
as instruction source. The class itself is abstract and does not implement any concrete function.
Any instruction source can be implemented as a derived class of `class ArielFrontend`, and be incorporated seamlessly
into Ariel core.

Specifically, the SST package provides an implementation, `class Pin3Frontend`, that works with Pin3, which is a binary 
instrumentation tool that dynamically rewrites application image in the main memory, such that the instruction trace 
can be obtained by invoking call backs after every instruction.
The instrumentation part (called a "pintool") is implemented as a separate module using the Pin library, and 
compiled into a dynamic library.
The program to be instrumented must be started as a separate process by invoking the pin binary with the pintool and 
program's binary. The pin binary will set up the execution environment for the pintool, load the application binary,
and then execute the binary with the instrumentations defined in the pintool.

`class Pin3Frontend` implements this process by calling `fork()` to create a child process, and then `execvp()`
to load the pin binary with command line arguments, including the path to the pintool, the path to the application 
binary, and arguments for running the application.
`class Pin3Frontend` also sets up the shared memory region, and pass the region name to the fork'ed child process
running Pin.
At the other side of the IPC channel, the pintool also contains a non-master mode Ariel tunnel object 
(`class ArielTunnel` in non-master mode) and a shared memory child object (`class MMAPChild_Pin3`).
Instructions intercepted by the instrumentation are sent over the tunnel object as message objects 
(`class ArielCommand`), which can be extracted on the simulator side and then fed into the Ariel core simulator.



